/** copySOuceObjectAndDecimate
  */
[RoutineDef, copySouceObjectAndDecimate
,
	//[Note, "copySouceObjectAndDecimate"]

	[IPress,Tool:SubTool:Duplicate]


	[RoutineCall, renameSubtool, "Shell-Source"]

	[VarSet, deciamtePercent, 20]

	[ISet, "Zplugin:Decimation Master:% of decimation", [Var, deciamtePercent] ]

	/* AHK LAUNCHED BELLOW WORKS ONLY IF SCRIPT IS CRUNNING FROM PLUGIN PALLETE, DOESN'T WORK IF LAUNCHED FROM SCRIPT PANE */
	//[VarSet, waitFoPreprocessAndExecuteDecimation, "C:\\GoogleDrive\\ProgramsData\\CG\\ZBrush\\Plugins\\INSTALLED\\ToolLoader\\ToolLoaderData\\Ahk\\waitFoPreprocessAndExecuteDecimation.ahk"]
	[VarSet, waitFoPreprocessAndExecuteDecimation,  [StrMerge, PLUGINDATAPATH, "\\Ahk\\waitFoPreprocessAndExecuteDecimation.ahk"]]

	//[FileExecute, ZFILEUTILSDLL, "LaunchAppWithFile",  #preprocessCurrent]
	[FileExecute, ZFILEUTILSDLL, "LaunchAppWithFile",  #waitFoPreprocessAndExecuteDecimation]

//, // PARAMS

]

/** zRemeshSubtool
  */
[RoutineDef, zRemeshSubtool
,
	//[Note, "zRemeshSubtool"]
	[IPress,Transform:Solo]

	[IPress,Tool:Geometry:Double]

	[IPress,Tool:Geometry:Adapt]

	[IUnPress,Tool:Geometry:Same]

	[IUnPress,Tool:Geometry:Half]

	[IUnPress,Tool:Geometry:FreezeBorder]

	[IUnPress,Tool:Geometry:KeepGroups]

	//[FileNameSetNext,"C:\Users\Public\Documents/ZBrushData2022/Temp/objIn.goz"]
	[IPress,Tool:Geometry:ZRemesher]

	/* HIDE ALL SUBTOOLS */
	[Loop, [SubToolGetCount],
		[VarSet,isVis,0]
		[RoutineCall,SubToolIsVisible,isVis, i ]

		[If, (isVis), //code for visible subtool
			[RoutineCall, subtoolVisibility, i , 0 ]]

	, i]

	/* SHOW SOURCE  */
	[RoutineCall, subtoolVisibility, [SubToolGetActiveIndex], 1 ]
	/* SHOW REMESHED  */
	[RoutineCall, subtoolVisibility, [SubToolGetActiveIndex] -1 , 1 ]
	[IPress,Tool:Geometry:Close Holes]

	/* PROJECT DETAILS */
	[IKeyPress,'2',[IPress,Tool:SubTool:ProjectAll]]


////, // PARAMS

]

/** extractShell
  */
[RoutineDef, extractShell
,

	[VarSet, sourceTool, [SubToolGetActiveIndex] - 1] // decimated copy of source objject
	[VarSet, subtoolDecimated, [SubToolGetActiveIndex]] // decimated copy of source objject
	[VarSet, countBeforeExplode, [SubToolGetCount]]




	[SubToolSelect, sourceTool ]
	[VarSet, sourceToolName, [FileNameExtract, [GetActiveToolPath], 2]]


	[RoutineCall, subtoolVisibility, subtoolDecimated - 1, 1 ]

	[SubToolSelect, subtoolDecimated ]


	[IPress,Tool:Polygroups:GroupVisible]


	[Note,

		[IGet,Tool:SubTool:Thick]
	 ,, 0]


	[IPress,Tool:SubTool:Extract]
	[IPress,Tool:SubTool:Accept]

	[RoutineCall, renameSubtool, [StrMerge, sourceToolName, "-INNER"] ]

	//[IPress,Tool:Polygroups:Auto Groups]


	[IKeyPress, '2', [IPress, Tool:Subtool:Groups Split]]


	[VarSet, explodedSubtoolsCount, [SubToolGetCount] - countBeforeExplode ]

	[SubToolSelect, subtoolDecimated ]



	/* DELETE OTHER MESHOSES AFTER EXPLODE, ONLY LAST IS LEFT */
	[Loop, explodedSubtoolsCount,
		[IKeyPress,'2',[IPress, Tool:SubTool:Delete]] // 2: Ok 3: always ok
	,i]


	[SubToolSelect, subtoolDecimated ]
	[RoutineCall, setBooleanSubstract ]


	[SubToolSelect, sourceTool ]
	[RoutineCall, setBooleanAdd ]

////, // PARAMS

]

/* liveBooleanOn
*/
[RoutineDef, liveBooleanOn
, /* function */
	[IUnPress,Transform: Pf]
	[IUnPress,Transform:Solo]
	//[CanvasStroke,(ZObjStrokeV03n3%p45AD8A8p3F31468PN-1NNs17F407Cs17F407Cs17F407Cz8000=
	//H183V4BCH183V4BCH183V4BC)]
	[IPress,Render:Render Booleans:Live Boolean]
]


/* Append slicer box
*/
[RoutineDef, appendSlicerBox
, /* function */

	[VarSet, maxSize, 2]

	[VarSet, xmin, 0]
	[VarSet, ymin, 0]
	[VarSet, zmin, 0]
	[VarSet, xmax, -1]
	[VarSet, ymax, -1]
	[VarSet, zmax, -1]

	[Mesh3DGet, 2, 2,, xmin, ymin, zmin, xmax, ymax, zmax]



	[VarDef,toolID,0]
	[VarSet,toolID,[IGet,Tool:Item Info]]

	[IPress,Tool:Cube3D]

	//store the new OBJ tool name
	[VarSet,toolName,[IGetTitle,Tool:Current Tool,0]]

	//select the main OBJ ztool
	[ISet,Tool:ItemInfo,#toolID]
	//append the new OBJ
	[If,[IExists,Tool:SubTool:Append],
		[IPress,Tool:SubTool:Append]
		[IPress,[StrMerge,"PopUp:",[Var,toolName]]]
	]

	[SubToolSelect, [SubToolGetCount] - 1 ]


	[ISet,Tool:Geometry:XYZ Size, maxSize ]
	[ISet,Tool:Geometry:Y Size, maxSize / 4 ]


	[ISet,Tool:Geometry:Y Position,  ymax ]

	[VarSet,subtoolPath,[StrMerge,"Tool:Subtool:", [IGetTitle,"Tool:Current Tool"]]]
//
	//[If,(2 & [IModGet,subtoolPath]) != 2,
		[VarSet,wid,[IWidth,subtoolPath]]

	[IClick,subtoolPath,wid-75,5]


	/* TURN POLYFRAME ON IF LIVE BOLLEAN IS ACTIVE */
	[If, [IGet,Render:Render Booleans:Live Boolean], // THEN
		[IPress,Transform: Pf]]


	[IPress,Transform:Fit]

	[IPress,Transform:Move]

]


/* maskByCavity
*/
[RoutineDef, maskByCavity
, /* function */

	[ISet,Tool:Masking:Blur,100]
	[ISet,Tool:Masking:Intensity,5]

	[IPress,Tool:Masking:Mask By Cavity]

	[IPress,Tool:Masking:Inverse]

//, /* parameters or output */

]