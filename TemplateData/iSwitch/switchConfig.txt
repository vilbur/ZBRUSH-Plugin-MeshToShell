/**
	----------------- ISWITCH MINDFUCK NOTES -----------------

	1. Script runs FIRST time on Zbrush startup, memory blocks are created in this time


	2. Script runs EVERY time any control is fired, if scripth has been interrupted by another plugin
		( If another plugin or script is used then first fire of control RUNS WHOLE SCRIPT AGAIN )


	3. First click on iSwitch FIRES EVENT OF INIT STATE, NOT OPPOSITE STATE as should be excepted
  		( if PRESSED, then FIRES PRESSED, if UNPRESSED, then fires UNPRESSED )

		BUT THIS HAPPEN ONLY IF ISWITCH IS IN INIT STATE
			( if INIT STATE is PRESSED and iSwitch is UNPRESSED, then works normaly  )

  */


[VarDef, $CONFIGFILE,	[FileNameResolvePath, "TemplateData\iSwitch\config.zvr"] ]


[VarDef, $plugin_initialized, [MemGetSize, CONFIG ] > 1 ]


[If, ! [MemGetSize, CONFIG ]
, // THEN create memory block

	[MVarDef, CONFIG,	1 ]
	[MVarDef, INIT_STATE,	1 ]
	[MVarDef, CURRENT_STATE,	1 ]

	/* SET DEFAULTS */
	[VarSet, $init_state, 1 ]

	[MVarSet, CONFIG,	0, [Var, $init_state] ]
	[MVarSet, INIT_STATE,	0, [Var, $init_state] ]
	[MVarSet, CURRENT_STATE,	0, [Var, $init_state] ]
	//[MVarSet, CURRENT_STATE,	0, -1 ]

//	[Note, "INIT: MEMORY CREATED",, 1]
//
//,
//	[Note, "MEMORY EXISTS",, 1]

	//[If, ! [FileExists, $CONFIGFILE]
	//, // THEN
	//
	//	[MemSaveToFile, CONFIG, $CONFIGFILE, 1]
	//
	////, // ELSE
	//]
	//
	//[MemCreateFromFile, CONFIG, $CONFIGFILE ]
	//[MemCreateFromFile, INIT_STATE, $CONFIGFILE ]

]


[VarSet, $PLUGIN_NENU, "~CONFIG_TEST"]

[VarSet, $CONTROLS_PATH,	[StrMerge, $PLUGIN_NENU, ":"]]	// MENU PATH: Menu > Submenu > Control

[VarSet, $switch_button, [StrMerge, $CONTROLS_PATH, "Switch"] ]


[IPalette, $PLUGIN_NENU ]



[ISwitch, $switch_button, [MVarGet, INIT_STATE, 0], ""
,
	[Note, "Enable",, 0.5]
	[MVarSet, CURRENT_STATE, 0, 1 ]
,

	[Note, "Disable",, 0.5]
	[MVarSet, CURRENT_STATE, 0, 0 ]

,,,	48]


/* FORCE SWITCH TO CORRECT STATE ON FIRST HIT, BUT NOT ON ZBRUSH STARTUP */
[If, [Var, $plugin_initialized] && ([MVarGet, CURRENT_STATE, 0 ] == [MVarGet, INIT_STATE, 0 ])
, // THEN
	[ISet,  $switch_button, ! [MVarGet, INIT_STATE, 0 ]  ]
]



